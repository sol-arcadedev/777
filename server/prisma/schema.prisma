generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SpinResult {
  PENDING
  WIN
  REFUND
  LOSE
}

model Configuration {
  id               Int      @id @default(1)
  tokenCA          String   @default("To be added")
  requiredHoldings BigInt   @default(500000)
  minSolTransfer   Float    @default(0.01)
  winChanceStart         Float    @default(2.0)
  winChanceEnd           Float    @default(8.0)
  rewardPercentStart     Float    @default(40.0)
  rewardPercentEnd       Float    @default(10.0)
  escalationDurationMin  Int      @default(60)
  escalationStartedAt    DateTime?
  timerDurationSec Int      @default(300)
  timerExpiresAt   DateTime?
  paused              Boolean  @default(false)
  feeClaimEnabled     Boolean  @default(false)
  feeClaimIntervalSec Int      @default(30)
  buybackEnabled      Boolean  @default(false)
  queueEnabled        Boolean  @default(false)
  slotActive          Boolean  @default(false)
  updatedAt           DateTime @updatedAt
}

model SpinTransaction {
  id             Int            @id @default(autoincrement())
  holderAddress  String
  solTransferred Float
  winChance      Float
  queuePosition  Int
  result         SpinResult
  rewardLamports    BigInt?
  txSignature       String?
  refundLamports    BigInt?
  refundTxSignature String?
  createdAt         DateTime       @default(now())

  reward RewardTransfer?
}

model RewardTransfer {
  id            Int      @id @default(autoincrement())
  winnerAddress String
  txSignature   String   @unique
  solWon        Float
  spinId        Int      @unique
  createdAt     DateTime @default(now())

  spin SpinTransaction @relation(fields: [spinId], references: [id])
}

model FeeClaim {
  id                Int      @id @default(autoincrement())
  claimTxSignature  String   @unique
  totalClaimed      Float
  treasuryAmount    Float
  rewardAmount      Float
  createdAt         DateTime @default(now())
}

model BuybackBurn {
  id                    Int      @id @default(autoincrement())
  transferTxSignature   String
  buybackTxSignature    String?
  burnTxSignature       String?
  solAmount             Float
  tokensBurned          BigInt?
  createdAt             DateTime @default(now())
}
